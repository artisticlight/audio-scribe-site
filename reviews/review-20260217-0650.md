# Code Review Report — audio-scribe-site

**Date:** 2026-02-17
**Branch:** `main`
**Scope:** Full codebase (48 files changed since initial commit)
**Review agents:** Security, Bugs, Performance, Code Quality, Pattern Conformity

---

## Summary

| Severity | Count |
|----------|-------|
| CRITICAL | 5 |
| HIGH     | 19 |
| MEDIUM   | 10 |
| LOW      | 1 |
| **Total** | **35** |

---

## CRITICAL

### 1. Duplicate `documentation` route — child routes unreachable

**File:** `src/app/app.routes.ts:8-30`
**Agents:** Bugs, Code Quality
**Confidence:** 100

Two entries share `path: 'documentation'`. The redirect on line 8 always matches first, so the second entry (lines 13-30) with `loadComponent` + `children` is unreachable. Navigating to `/documentation/getting-started`, `/documentation/features`, or `/documentation/faq` will fail.

**Fix:** Merge the redirect into the children as an empty-path child:

```typescript
{
  path: 'documentation',
  loadComponent: () => import('./pages/documentation/documentation.component').then(m => m.DocumentationComponent),
  children: [
    { path: '', redirectTo: 'getting-started', pathMatch: 'full' },
    { path: 'getting-started', loadComponent: () => import('./pages/documentation/getting-started/getting-started.component').then(m => m.GettingStartedComponent) },
    { path: 'features', loadComponent: () => import('./pages/documentation/features/features.component').then(m => m.FeaturesComponent) },
    { path: 'faq', loadComponent: () => import('./pages/documentation/faq/faq.component').then(m => m.FaqComponent) }
  ]
}
```

---

### 2. `localStorage`/`window` accessed at class field initialization — crashes in non-browser environments

**File:** `src/app/app.ts:33-47`
**Agents:** Bugs, Code Quality
**Confidence:** 95

`localStorage` and `window.matchMedia` are called in the field initializer and constructor without a browser guard. This crashes in SSR, unit tests (Node/JSDOM), Web Workers, or sandboxed iframes with storage blocked (`SecurityError`).

**Fix:** Guard with `typeof` checks:

```typescript
isDarkMode = signal(this.getInitialDarkMode());

private getInitialDarkMode(): boolean {
  if (typeof localStorage === 'undefined') return false;
  try {
    const stored = localStorage.getItem('darkMode');
    if (stored !== null) return stored === 'true';
  } catch { return false; }
  return typeof window !== 'undefined'
    ? window.matchMedia('(prefers-color-scheme: dark)').matches
    : false;
}
```

---

### 3. Inter font is render-blocking

**File:** `src/index.html:17`
**Agent:** Performance
**Confidence:** 95

The Inter font is loaded as a synchronous `<link rel="stylesheet">`, blocking first paint. The Material Symbols font already uses the non-blocking `onload` pattern, but Inter does not.

**Fix:** Use the same non-blocking pattern:

```html
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
```

---

### 4. Inter and Material Symbols fonts not subsetted

**File:** `src/index.html:17-18`
**Agent:** Performance
**Confidence:** 85

Neither font request limits character sets. The app uses ~27 Material Symbols icons but loads the entire icon library. Inter loads full Unicode ranges instead of just `latin`.

**Fix:** Add `&subset=latin` to Inter. For Material Symbols, use the `icon_names` parameter to request only used icons.

---

### 5. `APP_CONFIG` not frozen with `Object.freeze()`

**File:** `src/app/app.config.constants.ts:7-39`
**Agent:** Pattern Conformity
**Confidence:** 90

`APP_CONFIG` uses `as const` for type narrowing but is not runtime-frozen. Any code could mutate it at runtime, breaking the single-source-of-truth pattern.

**Fix:** Wrap with `Object.freeze()`:

```typescript
export const APP_CONFIG = Object.freeze({
  name: 'Audio Scribe',
  // ...
} as const);
```

---

## HIGH

### 6. Open redirect via unsanitized SPA redirect URL

**File:** `src/index.html:24-30`, `public/404.html`
**Agent:** Security
**Confidence:** 90

The GitHub Pages SPA redirect script in `404.html` encodes the full URL path into a query parameter and `index.html` blindly uses it in `history.replaceState`. An attacker can craft a URL that redirects users to a malicious path.

**Fix:** Validate that the redirect path starts with the expected base path before applying.

---

### 7. Missing `OnPush` change detection on 5 components

**Files:** `getting-started.component.ts`, `features.component.ts`, `about.component.ts`, `privacy.component.ts`, `support.component.ts`
**Agents:** Performance, Code Quality, Pattern Conformity, Bugs
**Confidence:** 95

Five lazily-loaded components default to `Default` change detection while the project convention is `OnPush`. These components render static/read-only data and trigger unnecessary dirty-checking on every browser event.

**Fix:** Add `changeDetection: ChangeDetectionStrategy.OnPush` to each component's decorator.

---

### 8. Empty XLF translation files — localized builds will fail

**Files:** `src/locale/messages.xlf`, `messages.es.xlf`, `messages.fr.xlf`
**Agent:** Bugs
**Confidence:** 95

All three XLF files are empty despite dozens of `i18n` attributes and `$localize` calls in the codebase. `ng build --localize` will fail or produce English-only output for `es`/`fr` locales.

**Fix:** Run `ng extract-i18n` to populate `messages.xlf`, then provide translations. Until then, remove the `es`/`fr` locale entries from `angular.json` to avoid broken builds.

---

### 9. `$localize` in class field initializers — strings frozen at construction

**Files:** `app.ts:40-44`, `home.component.ts:27-54`, `documentation.component.ts:24-27`, `support.component.ts:26-59`
**Agent:** Bugs
**Confidence:** 85

`$localize` tagged templates in instance field initializers are evaluated once at construction and never re-evaluated. This breaks runtime i18n if the locale changes dynamically and is architectural debt for any future migration.

---

### 10. `<base href="/">` conflicts with `angular.json` `baseHref` + SPA redirect path corruption

**Files:** `src/index.html:6`, `angular.json:53`
**Agent:** Bugs
**Confidence:** 85

`index.html` declares `<base href="/">` while `angular.json` sets `baseHref: "/audio-scribe-site/"`. The CLI overwrites at build time, but the hard-coded value is misleading. Additionally, the SPA redirect script uses `l.pathname.slice(0, -1)` which corrupts paths without a trailing slash.

**Fix:** Replace `slice(0, -1)` with `pathname.replace(/\/$/, '')` and remove the hard-coded `<base href="/">` from `index.html` (let the CLI handle it).

---

### 11. Dark mode does not react to OS preference changes

**File:** `src/app/app.ts:33-47`
**Agent:** Bugs
**Confidence:** 90

The initial dark mode state checks `prefers-color-scheme` once but never subscribes to the `change` event. Users who switch OS theme while the page is open see no update.

**Fix:** Add a `matchMedia` change listener in the constructor that updates the signal when no explicit `localStorage` preference is set.

---

### 12. Material v3 MDC CSS selectors are wrong — theme overrides not applied

**File:** `src/styles.scss:95-113`
**Agent:** Bugs
**Confidence:** 90

The selectors `mat-toolbar.mat-toolbar`, `mat-sidenav.mat-drawer`, `mat-card.mat-card` target Material v2 class names. Material v3 (MDC) uses `.mat-mdc-toolbar`, `.mat-drawer`, `.mat-mdc-card`. The custom background/color overrides for dark mode are silently not applied.

**Fix:** Update to MDC selectors:

```scss
.mat-mdc-toolbar { background-color: var(--sys-surface); color: var(--sys-on-surface); }
.mat-drawer { background-color: var(--sys-surface); }
.mat-mdc-card { background-color: var(--sys-surface); }
```

---

### 13. Unused `MatCardModule` and `MatIconModule` imports in `FeaturesComponent`

**File:** `src/app/pages/documentation/features/features.component.ts:2-3`
**Agents:** Bugs, Performance, Code Quality
**Confidence:** 95

The template contains no `<mat-card>` or `<mat-icon>` elements. These unused imports bloat the lazy chunk.

**Fix:** Remove both imports from the `imports` array.

---

### 14. `provideAnimations()` should be `provideAnimationsAsync()`

**File:** `src/app/app.config.ts:3,12`
**Agent:** Performance
**Confidence:** 85

`provideAnimations()` synchronously loads the animations engine into the initial bundle. `provideAnimationsAsync()` defers loading until first use — better for a content site.

**Fix:** Replace `provideAnimations` with `provideAnimationsAsync` from `@angular/platform-browser/animations/async`.

---

### 15. Wave animation uses `height` instead of GPU-composited `transform`

**File:** `src/app/pages/home/home.component.scss:107-114`
**Agent:** Performance
**Confidence:** 90

Animating `height` forces layout recalculation on every frame for 10 bars simultaneously. Only `transform` and `opacity` are GPU-composited.

**Fix:** Use `scaleY` transform instead. Set a fixed `height: 40px` and animate `transform: scaleY(0.5)` to `scaleY(1)`.

---

### 16. App Store badge image missing `width`/`height` — causes CLS

**File:** `src/app/app.html:108-111`
**Agents:** Performance, Code Quality, Pattern Conformity
**Confidence:** 88

The `<img>` has no intrinsic dimensions. With `loading="lazy"`, layout shift occurs when the image loads.

**Fix:** Add `width="120" height="40"` (Apple's standard badge dimensions).

---

### 17. Hardcoded "Audio Scribe" in FAQ/support components

**Files:** `src/app/pages/documentation/faq/faq.component.ts`, `src/app/pages/support/support.component.ts`
**Agent:** Pattern Conformity
**Confidence:** 90

These components hardcode the app name instead of using `APP_CONFIG.name`, breaking the centralized branding pattern.

**Fix:** Import `APP_CONFIG` and use `config.name` in templates and `$localize` interpolations.

---

### 18. Missing `i18n` attributes on CTA and support buttons

**Files:** `src/app/pages/home/home.component.html`, `src/app/pages/support/support.component.ts`
**Agent:** Pattern Conformity
**Confidence:** 88

Several interactive buttons and links lack `i18n` attributes, making them invisible to the translation extraction pipeline.

**Fix:** Add `i18n` attributes to all user-facing text in buttons and links.

---

### 19. Feature-card hover transform not guarded by `prefers-reduced-motion`

**File:** `src/app/pages/home/home.component.scss:148-153`
**Agent:** Pattern Conformity
**Confidence:** 88

The hover `translateY(-4px)` transition doesn't respect the user's reduced motion preference. The waveform animation already guards with `@media (prefers-reduced-motion)`, but the card hover does not.

**Fix:** Add a `prefers-reduced-motion` guard that disables the transform transition.

---

### 20. Inconsistent template strategy — inline vs external

**Agent:** Code Quality
**Confidence:** 85

Some components use `templateUrl` (external HTML files) while others use inline `template`. The project should pick one convention consistently.

---

### 21. Duplicated icon-card UI pattern

**Agent:** Code Quality
**Confidence:** 82

The icon + title + description card layout is repeated across home, features, and support pages. This could be extracted into a shared component.

---

### 22. Duplicated `.section-title` / `.section-subtitle` CSS

**File:** `src/app/pages/home/home.component.scss`
**Agent:** Code Quality
**Confidence:** 85

Section heading styles are duplicated across components instead of being in shared styles.

---

### 23. Magic number `56px` toolbar height

**File:** `src/app/app.scss`
**Agent:** Code Quality
**Confidence:** 80

Hardcoded `56px` for toolbar height instead of using a CSS custom property or the Material toolbar's own variable.

---

### 24. Missing `aria-label` on App Store download link

**File:** `src/app/app.html`
**Agent:** Code Quality
**Confidence:** 85

The download link wrapping the App Store badge image has no accessible label beyond the `alt` text.

---

## MEDIUM

### 25. No Content Security Policy (CSP) defined

**Agent:** Security
**Confidence:** 85

No CSP headers or meta tags restrict script/style sources. XSS attacks would have unrestricted access.

---

### 26. External fonts loaded without Subresource Integrity (SRI)

**File:** `src/index.html:15-18`
**Agent:** Security
**Confidence:** 80

Google Fonts CSS is loaded without `integrity` attributes, leaving the app vulnerable to CDN compromise.

---

### 27. `localStorage` on shared `github.io` origin

**Agent:** Security
**Confidence:** 75

On `*.github.io`, all repos under the same user share `localStorage`. The `darkMode` key could collide with other projects.

---

### 28. `mailto:` href concatenation pattern

**Agent:** Security
**Confidence:** 70

Template-concatenated `mailto:` links could theoretically be manipulated if the config values were ever user-controlled.

---

### 29. Missing `i18n` attributes on remaining static strings

**Agent:** Code Quality
**Confidence:** 82

Several static text elements throughout the app lack `i18n` attributes for translation extraction.

---

### 30. Waveform `div` elements missing `aria-hidden="true"`

**File:** `src/app/pages/home/home.component.html`
**Agent:** Code Quality
**Confidence:** 85

The decorative waveform animation divs are announced by screen readers. They should be hidden from the accessibility tree.

---

### 31. `skipTests: true` on all schematics

**File:** `angular.json:19-44`
**Agent:** Code Quality
**Confidence:** 75

Every schematic type skips test generation. This discourages test creation for all new components, services, etc.

---

### 32. Dark mode tooltip text not localized

**File:** `src/app/app.html`
**Agent:** Pattern Conformity
**Confidence:** 82

The tooltip showing "Switch to light/dark mode" is not wrapped with `i18n` or `$localize`.

---

### 33. No font preload — self-hosting would eliminate extra round-trips

**File:** `src/index.html:15-17`
**Agent:** Performance
**Confidence:** 82

No `<link rel="preload" as="font">` exists for Inter's `.woff2` file. Self-hosting with explicit preload would remove two Google Fonts round-trips from the critical path.

---

### 34. Feature card hover transitions `box-shadow` (triggers paint)

**File:** `src/app/pages/home/home.component.scss:148-153`
**Agent:** Performance
**Confidence:** 82

`box-shadow` is not GPU-composited. Transitioning it alongside `transform` forces paint on every hover frame across 6 cards.

---

## LOW

### 35. `inlineCritical: true` blocks strict CSP adoption

**File:** `angular.json:73`
**Agent:** Security
**Confidence:** 70

Inlined critical CSS requires `unsafe-inline` in the CSP `style-src` directive, preventing strict CSP. If CSP is adopted later, this setting must be disabled or nonces added.

---

*Report generated by 5 parallel review agents (Security, Bugs, Performance, Code Quality, Pattern Conformity).*
